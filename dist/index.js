'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _bars=require('./barchart/bars.js'),_lines=require('./linechart/lines.js'),_slices=require('./piechart/slices.js'),_dots=require('./scatterplot/dots.js'),_svg=require('./svg'),_axes=require('./lib/axes.js'),axes=_interopRequireWildcard(_axes),_data=require('./lib/data.js'),dataFunctions=_interopRequireWildcard(_data),_scales=require('./lib/scales.js'),scales=_interopRequireWildcard(_scales),_react=require('react'),_react2=_interopRequireDefault(_react),_table=require('./table');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Chart=function(_React$Component){function Chart(a){_classCallCheck(this,Chart);var _this=_possibleConstructorReturn(this,(Chart.__proto__||Object.getPrototypeOf(Chart)).call(this,a));return _this.state={containerHeight:200,containerWidth:200},_initialiseProps.call(_this),_this.state={containerHeight:200,containerWidth:200},_this}return _inherits(Chart,_React$Component),_createClass(Chart,null,[{key:'defaultProps',get:function get(){return{chart:{data:{},margins:{}},chartDataGroupBy:'',// eslintignore required for line chart
// bar|scatterplot|pie|line
// scatterplot: requires x and y values to be integers
chartType:'',colorScaleScheme:'',colorScaleType:'',datumLabels:[],filterable:!1,id:'reactjs-d3-v4-universal',margins:{},preserveAspectRatio:'xMinYMin meet',sortable:!1,xAxis:!1,xAxisLabel:'',xScale:!1,xScaleTime:!1,// eslintignore required for line chart
xScaleTimeFormat:'',// eslintignore required for line chart https://github.com/d3/d3-time-format/blob/master/README.md#locale_format
xValue:'',yAxis:!1,yAxisLabel:'',yScale:!1,yValue:''}}}]),_createClass(Chart,[{key:'componentDidMount',value:function componentDidMount(){'table'===this.props.chartType&&(appFuncs.filterTable.setFilterGrid('table'),appFuncs.sortTable.init()),this.setSize(),'undefined'!=typeof window&&window.addEventListener('resize',this.setSize,!1)}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(a,b){return!appFuncs._.isEqual(b,this.state)||!appFuncs._.isEqual(a,this.props)}},{key:'componentWillUnmount',value:function componentWillUnmount(){'undefined'!=typeof window&&window.removeEventListener('resize',this.setSize)}},{key:'render',value:function render(){var _this2=this;if(appFuncs._.isEmpty(this.props.chart.data))return appFuncs.logError({data:this.props.chart,loc:__filename,msg:'You need data to create a chart, return null'}),null;var a=void 0;switch(this.props.chartType.toLowerCase()){case'pie':a=_slices.PieSlices;break;case'bar':a=_bars.Bars;break;case'scatterplot':a=_dots.ScatterPlotDots;break;case'line':a=_lines.Lines;break;case'table':a=_table.Table;break;default:return appFuncs.logError({data:[this.props.chartType,this.props.chart],loc:__filename,msg:'did not find chart type '+this.props.chartType+', returning null'}),null;}var b=this.state.containerHeight-(this.props.margins.top+this.props.margins.bottom),c=this.state.containerWidth-(this.props.margins.left+this.props.margins.right),d=this.props.colorScaleScheme?scales.colorScale({chartDataGroupBy:this.props.chartDataGroupBy,colorScaleScheme:this.props.colorScaleScheme,colorScaleType:this.props.colorScaleType}):null,e=dataFunctions.format({chartDataGroupBy:this.props.chartDataGroupBy,chartType:this.props.chartType,data:this.props.chart.data,xScaleTime:this.props.xScaleTime,xScaleTimeFormat:this.props.xScaleTimeFormat,xValue:this.props.xValue}),f='undefined'!=typeof document,g=this.props.xAxis?axes.getXAxisLabel({chartDataGroupBy:this.props.chartDataGroupBy,transform:'rotate(0)',x:this.state.containerWidth/2-this.props.margins.left,xAxisLabel:this.props.xAxisLabel||this.props.xValue,y:this.state.containerHeight}):null,h=this.props.xScale?scales.getXScale({chartDataGroupBy:this.props.chartDataGroupBy,chartHeight:b,chartType:this.props.chartType,chartWidth:c,data:e,labels:this.props.datumLabels,margins:this.props.margins,svgWidth:this.state.containerWidth,xScaleTime:this.props.xScaleTime,xScaleTimeFormat:this.props.xScaleTimeFormat,xValue:this.props.xValue}):null,i=this.props.yAxis?axes.getYAxisLabel({chartDataGroupBy:this.props.chartDataGroupBy,transform:'rotate(-90)',// x & y flip because of rotation
x:-this.state.containerHeight/2-this.props.margins.top,y:'1em',yAxisLabel:this.props.yAxisLabel||this.props.yValue}):null,j=this.props.yScale?scales.getYScale({chartDataGroupBy:this.props.chartDataGroupBy,chartHeight:b,chartType:this.props.chartType,chartWidth:c,data:e,margins:this.props.margins,svgHeight:this.state.containerHeight,yValue:this.props.yValue}):null;this.props.yAxis&&j&&f&&axes.getYAxis({id:this.props.id,thisYScale:j}),this.props.xAxis&&h&&f&&axes.getXAxis({id:this.props.id,thisXScale:h});var k=a({chartDataGroupBy:this.props.chartDataGroupBy,chartHeight:b,chartType:this.props.chartType,chartWidth:c,colorScale:d,colorScaleScheme:this.props.colorScaleScheme,colorScaleType:this.props.colorScaleType,data:e,filterable:this.props.filterable,id:this.props.id,labels:this.props.datumLabels,sortable:this.props.sortable,xScale:h,xScaleTime:this.props.xScaleTime,xScaleTimeFormat:this.props.xScaleTimeFormat,xValue:this.props.xValue,yScale:j,yValue:this.props.yValue}),l='table'===this.props.chartType?k:_react2.default.createElement(_svg.SVG,{id:this.props.id,preserveAspectRatio:this.props.preserveAspectRatio,svgHeight:this.state.containerHeight,svgWidth:this.state.containerWidth},_react2.default.createElement('g',{className:'chart-svg-g',height:b,transform:'translate('+this.props.margins.left+', '+this.props.margins.top+')',width:c},_react2.default.createElement('g',{className:this.props.chartType.toLowerCase()+'-visual-container',transform:this.getVisualContainerTransform({chartHeight:b,chartType:this.props.chartType,chartWidth:c})},k)),this.props.xAxis&&_react2.default.createElement('g',{className:'x axis',transform:'translate('+this.props.margins.left+', '+(b+this.props.margins.top)+')'}),g,this.props.yAxis&&_react2.default.createElement('g',{className:'y axis',transform:'translate('+this.props.margins.left+', '+this.props.margins.top+')'}),i,_react2.default.createElement('section',{id:this.props.id+'-tooltip',style:{backgroundColor:'black',border:'2px red dashed',borderRadius:'4px',opacity:0,padding:'10px',position:'absolute'}}));return _react2.default.createElement('section',{className:'chart-container',ref:function ref(m){return _this2.container=m},style:{display:'block',overflow:'scroll',position:'relative',verticalAlign:'top',width:'100%'}},l)}}]),Chart}(_react2.default.Component);Chart.propTypes={chart:_react2.default.PropTypes.object,chartDataGroupBy:_react2.default.PropTypes.string,chartType:_react2.default.PropTypes.string,colorScaleScheme:_react2.default.PropTypes.string,colorScaleType:_react2.default.PropTypes.string,datumLabels:_react2.default.PropTypes.array,filterable:_react2.default.PropTypes.bool,id:_react2.default.PropTypes.string,margins:_react2.default.PropTypes.object,preserveAspectRatio:_react2.default.PropTypes.string,sortable:_react2.default.PropTypes.bool,xAxis:_react2.default.PropTypes.bool,xAxisLabel:_react2.default.PropTypes.string,xScale:_react2.default.PropTypes.bool,xScaleTime:_react2.default.PropTypes.bool,xScaleTimeFormat:_react2.default.PropTypes.string,xValue:_react2.default.PropTypes.string,yAxis:_react2.default.PropTypes.bool,yAxisLabel:_react2.default.PropTypes.string,yScale:_react2.default.PropTypes.bool,yValue:_react2.default.PropTypes.string};var _initialiseProps=function _initialiseProps(){var _this3=this;this.setSize=function(){var a=void 0,b=void 0;try{a=_this3.container.offsetHeight}catch(c){a=_this3.state.containerHeight}try{b=_this3.container.offsetWidth}catch(c){b=_this3.state.containerWidth}return _this3.setState({containerHeight:a,containerWidth:b}),!0},this.getVisualContainerTransform=function(_ref){var a=_ref.chartHeight,b=_ref.chartType,c=_ref.chartWidth;switch(b.toLowerCase()){case'pie':return'translate('+[c/2,a/2]+')';default:return'translate(0, 0)';}}};exports.default=Chart;