'use strict';Object.defineProperty(exports,'__esModule',{value:!0});exports.format=exports.groupBy=exports.createDataValues=exports.sumGroupedData=exports.formatTime=exports.checkTimeFormat=void 0;var _extends=Object.assign||function(target){for(var source,i=1;i<arguments.length;i++)for(var key in source=arguments[i],source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key]);return target};var _time=require('./time.js'),time=_interopRequireWildcard(_time);function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var checkTimeFormat=exports.checkTimeFormat=function(_ref){var a=_ref.data,b=_ref.parseTime,c=_ref.timeProperty,f=_ref.xScaleTimeFormat;try{return!b(a[0][c])&&time.format({format:f});// return parseTime(time.format({ format: xScaleTimeFormat })(new Date("Fri Mar 17 16:50:48 +0000 2017")))
}catch(g){return new Error('something went wrong accessing data[0]['+c+'] inside lib/data.js.checkTimeFormat(), or creating a time formatter with format '+f+', heres the message '+g.message)}};var formatTime=exports.formatTime=function(_ref2){var a=_ref2.data,_ref2$timeProperty=_ref2.timeProperty,b=void 0===_ref2$timeProperty?'':_ref2$timeProperty,_ref2$xScaleTimeForma=_ref2.xScaleTimeFormat,c=void 0===_ref2$xScaleTimeForma?'':_ref2$xScaleTimeForma;if(!b||!c||appFuncs._.isEmpty(a))return appFuncs.logError({data:[a,b,c],loc:__filename,msg:'timeProperty and xScaleTimeFormat must be valid variables in data.formatTime(), returning data without transformations'}),a;var f=time.parse({format:c}),g=[],h=checkTimeFormat({data:a,parseTime:f,timeProperty:b,xScaleTimeFormat:c});// parse time as is
return(h||a.forEach(function(i){return g.push(_extends({},i,_defineProperty({},b,f(i[b]))))}),h instanceof Error)?(appFuncs.logError({data:[a,b,c,h],loc:__filename,msg:h.message+', returning data without processing time, your chart is likely fucked up'}),a):(h&&a.forEach(function(i){return g.push(_extends({},i,_defineProperty({},b,f(h(new Date(i[b]))))))}),g)};var sumGroupedData=exports.sumGroupedData=function(_ref3){var a=_ref3.chartDataGroupBy,b=_ref3.data,c=_ref3.xValue,f=_ref3.yValue,g={};return b.forEach(function(h){var _g$h$c;g[h[c]]?(g[h[c]][f]+=h[f],g[h[c]].originalDataList.push(h)):g[h[c]]=(_g$h$c={},_defineProperty(_g$h$c,a,h[a]),_defineProperty(_g$h$c,c,h[c]),_defineProperty(_g$h$c,f,h[f]),_defineProperty(_g$h$c,'originalDataList',[h]),_g$h$c)}),Object.values(g)};// groups an array of objects by some property value
// returns an object where each property is an array of objects with a matching property  value
// in separate function for VM compiler optimization
var createDataValues=exports.createDataValues=function(_ref4){var a=_ref4.chartDataGroupBy,b=_ref4.data,c=void 0;try{c=appFuncs._.groupBy(b,function(f){if('undefined'==typeof f[a])throw new Error('key '+a+' does not exist in '+JSON.stringify(Object.keys(f))+'. exiting lib/data.groupBy. here is the entire object '+f);return f[a]})}catch(f){c=f}return c};var groupBy=exports.groupBy=function(_ref5){var _ref5$chartDataGroupB=_ref5.chartDataGroupBy,f=void 0===_ref5$chartDataGroupB?'':_ref5$chartDataGroupB,_ref5$chartDataSumGro=_ref5.chartDataSumGroupBy,g=void 0!==_ref5$chartDataSumGro&&_ref5$chartDataSumGro,a=_ref5.data,b=_ref5.xScaleTime,c=_ref5.xScaleTimeFormat,_ref5$xValue=_ref5.xValue,h=void 0===_ref5$xValue?'':_ref5$xValue,_ref5$yValue=_ref5.yValue,i=void 0===_ref5$yValue?'':_ref5$yValue;if(appFuncs._.isEmpty(a)||!f)return appFuncs.logError({data:[f,a],loc:__filename,msg:'data and chartDataGroupBy must be valid variables in data.groupBy(), returning data without transformations'}),a;// group all values by chartDataGroupBy, each group is a line on a chart
var j=createDataValues({chartDataGroupBy:f,chartDataSumGroupBy:g,data:a,xValue:h,yValue:i});if(appFuncs._.isEmpty(j)||j instanceof Error)return appFuncs.logError({data:[a,j],loc:__filename,msg:'could not create groups for data on key '+f+', returning data'}),a;// create object with values and keys for each lineValues group
var k=Object.keys(j).map(function(l){var m=[];// transform time if required
return b&&c&&(m=formatTime({data:j[l],timeProperty:h,xScaleTimeFormat:c})),m.length&&g&&i&&h&&(m=sumGroupedData({chartDataGroupBy:f,data:m,xValue:h,yValue:i})),{id:l,values:m.length?m:j[l]}});return k};var format=exports.format=function(_ref6){var _ref6$chartDataGroupB=_ref6.chartDataGroupBy,b=void 0===_ref6$chartDataGroupB?'':_ref6$chartDataGroupB,_ref6$chartDataSumGro=_ref6.chartDataSumGroupBy,_ref6$chartType=_ref6.chartType,f=void 0===_ref6$chartType?'':_ref6$chartType,a=_ref6.data,_ref6$xScaleTime=_ref6.xScaleTime,g=void 0!==_ref6$xScaleTime&&_ref6$xScaleTime,_ref6$xScaleTimeForma=_ref6.xScaleTimeFormat,h=void 0===_ref6$xScaleTimeForma?'':_ref6$xScaleTimeForma,_ref6$xValue=_ref6.xValue,i=void 0===_ref6$xValue?'':_ref6$xValue,_ref6$yValue=_ref6.yValue,j=void 0===_ref6$yValue?'':_ref6$yValue;if(appFuncs._.isEmpty(a))return a;switch(f.toLowerCase()){case'pack':return a;case'forcedirectedgraph':/*
      const
        links = data.links,
        nodeByGroup = data.nodes.map((node) => node[chartDataGroupBy]),
        nodes = data.nodes;

      links.forEach((link) => {
        const
          source = nodeByGroup.find((node) => { if (node) return node[link.source[chartDataGroupBy]]}),
          target = nodeByGroup.find((node) => { if (node) return node[link.target[chartDataGroupBy]]});

        links.push(
          { source, target },
          { source: intermediate, target },
        );
      });

      return { links, nodeByGroup, nodes };
      */return a;case'table':case'line':case'scatterplot':case'bar':case'pie':default:// Group data and return
return b?groupBy({chartDataGroupBy:b,chartDataSumGroupBy:void 0!==_ref6$chartDataSumGro&&_ref6$chartDataSumGro,data:a,xScaleTime:g,xScaleTimeFormat:h,xValue:i,yValue:j}):g&&h?formatTime({data:a,timeProperty:i,xScaleTimeFormat:h}):a;// transform time and return
}};