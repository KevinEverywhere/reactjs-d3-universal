'use strict';Object.defineProperty(exports,'__esModule',{value:!0});exports.createText=exports.createTable=void 0;var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _d=require('d3'),d3=_interopRequireWildcard(_d),_react=require('react'),_react2=_interopRequireDefault(_react),_text=require('./text.js'),_text2=_interopRequireDefault(_text),_index=require('../index.js'),_index2=_interopRequireDefault(_index);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}/* eslint-disable */var createTable=exports.createTable=function(_ref){var a=_ref.metadata,b=_ref.diameter,c=_ref.id,f=_ref.idx,_ref$margins=_ref.margins,h=void 0===_ref$margins?{top:2,right:2,bottom:2,left:2}:_ref$margins;return _react2.default.createElement(_index2.default,{chartType:'table',containerHeight:b,containerWidth:b,data:a,filterable:!1,id:c+'-table-'+f,margins:h,sortable:!1})};var createText=exports.createText=function(_ref2){var a=_ref2.d,b=_ref2.idx,c=_ref2.labels,f=_ref2.r;return _react2.default.createElement(_text2.default,{d:a,idx:b,labels:c,r:f})};var PackG=function(_React$Component){function PackG(a){_classCallCheck(this,PackG);var _this=_possibleConstructorReturn(this,(PackG.__proto__||Object.getPrototypeOf(PackG)).call(this,a));return _this.state={previous:{},r:0,scale:1,scaled:!1,x:0,y:0},_initialiseProps.call(_this),_this.state={previous:{},r:0,scale:1,scaled:!1,x:0,y:0},_this}return _inherits(PackG,_React$Component),_createClass(PackG,null,[{key:'defaultProps',get:function get(){return{colorScale:function colorScale(){return null},d:{},foreignObject:!1,id:'',idx:0,labels:[]}}}]),_createClass(PackG,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){(a.d.x!==this.props.d.x||a.d.y!==this.props.d.y)&&this.setState({r:a.d.r,x:a.d.x,y:a.d.y})}},{key:'render',value:function render(){var _this2=this,_props=this.props,a=_props.colorScale,b=_props.d,c=_props.idx,f=_props.labels;return _react2.default.createElement('g',{key:c,onClick:function onClick(h){h.stopPropagation(),_this2.handleZoom()},ref:function ref(h){return _this2.g=h},transform:'translate('+(this.state.x||this.props.d.x)+', '+(this.state.y||this.props.d.y)+') scale('+this.state.scale+')'},_react2.default.createElement('circle',{className:b.parent?b.children?'node':'node node--leaf':'node node--root',r:this.state.r||this.props.d.r,ref:function ref(h){return _this2.circle=h},style:{fill:b.children?a(b.depth):'white',stroke:'#fff',strokeWidth:'1.5px'}}),!b.children&&createText({d:b,idx:c,labels:f,r:this.state.r||this.props.d.r}),this.props.foreignObject&&_react2.default.createElement('g',{transform:'translate(-'+this.state.r/2+', 0)'},_react2.default.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',xmlnsXlink:'http://www.w3.org/1999/xlink'},_react2.default.createElement('a',{xlinkHref:''+this.props.foreignObject[0].url,target:'_blank'},_react2.default.createElement('image',{xlinkHref:this.props.foreignObject[0].imageUrl,height:this.state.r/2,width:this.state.r/2}),_react2.default.createElement('svg',{xmlns:'http://www.w3.org/2000/svg',width:this.state.r/2,height:this.state.r/2,viewBox:'0 0 '+this.state.r/2+' '+this.state.r/2}))),_react2.default.createElement('text',{fontSize:10,fill:'black',textAnchor:'middle',transform:'translate('+(this.state.r+1)+', 10)',fontFamily:'\'Lucida Grande\', sans-serif'},this.props.foreignObject[0].tweet.substring(0,10)),_react2.default.createElement('text',{fontSize:10,fill:'black',textAnchor:'middle',transform:'translate('+(this.state.r+1)+', 20)',fontFamily:'\'Lucida Grande\', sans-serif'},this.props.foreignObject[0].tweet.substring(10,18))),this.props.children||null)}}]),PackG}(_react2.default.Component);PackG.propTypes={colorScale:_react2.default.PropTypes.func,d:_react2.default.PropTypes.object,foreignObject:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.bool,_react2.default.PropTypes.array]),id:_react2.default.PropTypes.string,idx:_react2.default.PropTypes.number,labels:_react2.default.PropTypes.array};var _initialiseProps=function(){var _this3=this;this.updateDimensions=function(a,b){if(!_this3.state.scaled){_this3.setState({previous:_this3.g.previousElementSibling}),b.appendChild(_this3.g);var c=d3.interpolate([_this3.state.x,_this3.state.y,1],[0,0,a.width/2/_this3.state.r]),f=0,h=d3.interval(function(){f+=0.1,_this3.setState({x:c(f)[0],y:c(f)[1],scale:c(f)[2]}),(0.9<f||_this3.state.scaled)&&(h.stop(),_this3.setState({scaled:!0}))},10)}else var _c=d3.interpolate([_this3.state.x,_this3.state.y,_this3.state.scale],[_this3.props.d.x,_this3.props.d.y,1]),_f=0,_h=d3.interval(function(){_f+=0.1,_this3.setState({x:_c(_f)[0],y:_c(_f)[1],scale:_c(_f)[2]}),(0.9<_f||!_this3.state.scaled)&&(_h.stop(),_this3.state.previous.parentNode.insertBefore(_this3.g,_this3.state.previous.nextSibling),_this3.setState({scaled:!1}))},10);return!0},this.handleZoom=function(){var a=document.getElementById(_this3.props.id+'-visual-container').firstElementChild.firstElementChild;return!!a&&a!==_this3.g&&_this3.updateDimensions(a.getBoundingClientRect(),a)}};exports.default=PackG;