'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _d=require('d3'),d3=_interopRequireWildcard(_d),_react=require('react'),_react2=_interopRequireDefault(_react),_text=require('./text.js'),_text2=_interopRequireDefault(_text);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}/* eslint-disable *//**
 * wraps a set of pack nodes inside a <g> ELEMENT
 */var PackG=function(_React$Component){function PackG(a){_classCallCheck(this,PackG);var _this=_possibleConstructorReturn(this,(PackG.__proto__||Object.getPrototypeOf(PackG)).call(this,a));return _this.state={previous:{},r:0,scale:1,scaled:!1,scaling:!1,x:0,y:0,fontSize:'5px'},_initialiseProps.call(_this),_this.state={previous:{},r:0,scale:1,scaled:!1,scaling:!1,x:0,y:0,fontSize:'5px'},_this}return _inherits(PackG,_React$Component),_createClass(PackG,null,[{key:'defaultProps',get:function get(){return{colorScale:function colorScale(){return null},d:{},foreignObject:!1,id:'',idx:0,labels:[]}}}]),_createClass(PackG,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){(a.d.x!==this.props.d.x||a.d.y!==this.props.d.y)&&this.setState({r:a.d.r,x:a.d.x,y:a.d.y})}/**
   * updates x, y and r dimensions for a set of pack nodes
   *//**
   * zooms in/out of a pack node
   */},{key:'render',value:function render(){var _this2=this,_props=this.props,a=_props.colorScale,b=_props.d,c=_props.idx,f=_props.labels;return _react2.default.createElement('g',{className:'pack-g',key:c,onClick:function onClick(h){h.stopPropagation(),_this2.handleZoom()},ref:function ref(h){return _this2.g=h},transform:'translate('+(this.state.x||this.props.d.x)+', '+(this.state.y||this.props.d.y)+') scale('+this.state.scale+')'},_react2.default.createElement('circle',{className:b.parent?b.children?'node':'node node--leaf':'node node--root',r:this.state.r||this.props.d.r,ref:function ref(h){return _this2.circle=h},style:{fill:b.children?a(b.depth):'white',stroke:'#fff',strokeWidth:'1.5px'}}),!b.children&&_react2.default.createElement(_text2.default,{d:b,idx:c,labels:f,scale:this.state.scale,r:this.state.r}),this.props.foreignObject&&_react2.default.createElement('g',{className:'foreign-object-g',transform:'translate('+1.2*-(this.state.r||this.props.d.r)+', '+-(this.state.r||this.props.d.r)/2+')'},_react2.default.createElement('svg',{className:'foreign-object-svg',height:1.5*(this.state.r||this.props.d.r),version:'1.1',width:1.5*(this.state.r||this.props.d.r),x:(this.state.r||this.props.d.r)/2+2,xmlns:'http://www.w3.org/2000/svg',xmlnsXlink:'http://www.w3.org/1999/xlink'},_react2.default.createElement('foreignObject',{x:'0',y:'0',width:'100%',height:'100%',transform:'translate(0,0)'},_react2.default.createElement('div',{style:{height:1.3*(this.state.r||this.props.d.r)+'px',overflowY:'auto',overflowX:'hidden',display:'flex',justifyContent:this.state.scaled?'flex-start':'space-around',alignContent:this.state.scaled?'flex-start':'center',alignItems:this.state.scaled?'flex-start':'center',flexWrap:'wrap'}},this.displayForeignObjects())))),this.props.children||null)}}]),PackG}(_react2.default.Component);PackG.propTypes={colorScale:_react2.default.PropTypes.func,d:_react2.default.PropTypes.object,foreignObject:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.bool,_react2.default.PropTypes.array]),id:_react2.default.PropTypes.string,idx:_react2.default.PropTypes.number,labels:_react2.default.PropTypes.array};var _initialiseProps=function(){var _this3=this;this.updateDimensions=function(a,b){if(_this3.setState({scaling:!0}),!_this3.state.scaled){_this3.setState({previous:_this3.g.previousElementSibling}),b.appendChild(_this3.g);var c=d3.interpolate([_this3.state.x,_this3.state.y,1],[0,0,a.width/2/_this3.state.r]),f=0,h=d3.interval(function(){f+=0.1,_this3.setState({x:c(f)[0],y:c(f)[1],scale:c(f)[2]}),(0.9<f||_this3.state.scaled)&&(h.stop(),_this3.setState({scaled:!0,scaling:!1}),_this3.displayForeignObjects())},10)}else// scale it down
var _c=d3.interpolate([_this3.state.x,_this3.state.y,_this3.state.scale],[_this3.props.d.x,_this3.props.d.y,1]),_f=0,_h=d3.interval(function(){_f+=0.1,_this3.setState({x:_c(_f)[0],y:_c(_f)[1],scale:_c(_f)[2]}),(0.9<_f||!_this3.state.scaled)&&(_h.stop(),_this3.state.previous.parentNode.insertBefore(_this3.g,_this3.state.previous.nextSibling),_this3.setState({scaled:!1,scaling:!1}),_this3.displayForeignObjects())},10);return!0},this.handleZoom=function(){var a=document.getElementById(_this3.props.id+'-visual-container').firstElementChild.firstElementChild;return!!a&&a!==_this3.g&&_this3.updateDimensions(a.getBoundingClientRect(),a)},this.setTransform=function(_ref){var a=_ref.idx,b=_ref.total,c=_ref.width,f=_ref.xOffset,h=_ref.yOffset,j=_ref.scaled,k=a/3;k=k.toFixed(2);var l=+k.toString().split('.')[1],m=+k.toString().split('.')[0],n=void 0,o=void 0;switch(b){case 1:return'translate('+-c/2+', '+-c/2+')';case 2:{n=0==l?-_this3.state.r/2:0,o=-c/2;break}case 3:{n=0==l?f:33==l?f+c:f+2*c,o=-c/2;break}default:n=0==l?f:33==l?f+c:f+2*c,o=h+m*c;}return'translate('+n+', '+o+')'},this.getTransform=function(_ref2){var a=_ref2.idx,b=_ref2.total,c=_ref2.width,f=_ref2.xOffset,h=_ref2.yOffset,j=_ref2.scaled;if(_this3.state.scaling)return!1;if(1===j){for(;-1<--b;)_this3['g'+b].setAttribute('transform','translate(-'+0.85*(_this3.state.r||_this3.props.d.r)+', '+(-1*(_this3.state.r||_this3.props.d.r)/1.8+b*(_this3.state.r||_this3.props.d.r)/2)+')');return!0}if(-1===j){for(;a++<b;)_this3['g'+a].setAttribute('transform',_this3.setTransform({idx:a,total:b,width:c,xOffset:f,yOffset:h,scaled:j}));return!0}return _this3.setTransform({idx:a,total:b,width:c,xOffset:f,yOffset:h,scaled:j})},this.displayForeignObjects=function(){if(_this3.state.scaling)return null;/*
    return this.state.scaling
      ? false
      : scaled !== 0
      ? this.getTransform({
        total: this.props.foreignObject.length,
        width: (this.state.r || this.props.d.r)/2,
        xOffset: -1 * (this.state.r || this.props.d.r) * 0.75,
        yOffset:-1 * (this.state.r || this.props.d.r)/2,
        scaled,
      })
      :
    */var a=[];return _this3.props.foreignObject.forEach(function(b,c){a.push(_react2.default.createElement('div',{key:c,className:'foreign-object-data',style:{display:_this3.state.scaled?'block':'inline-block',fontSize:(_this3.state.r||_this3.props.d.r)/16+'px'}},_react2.default.createElement('img',{className:'foreign-object-img',src:b.imageUrl,height:0.2*(_this3.state.r||_this3.props.d.r),width:0.24*(_this3.state.r||_this3.props.d.r),style:{marginRight:'2px'}}),_react2.default.createElement('div',{className:'foreign-object-text',style:{display:_this3.state.scaled?'block':'none'}},_react2.default.createElement('a',{href:'https://www.twitter.com/'+b.username,target:'_blank',style:{float:'left'}},b.username),_react2.default.createElement('span',{style:{margin:0,marginTop:'2px',border:'none',lineHeight:1.1,height:0.2*(_this3.state.r||_this3.props.d.r)+'px',width:1.3*(_this3.state.r||_this3.props.d.r)+'px',display:'inline-block',float:'left',clear:'left'}},b.tweet.substring(0,90),_react2.default.createElement('a',{href:b.url,target:'_blank',style:{fontStyle:'italic'}},' ...read more')))))}),a}};exports.default=PackG;