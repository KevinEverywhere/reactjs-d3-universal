'use strict';Object.defineProperty(exports,'__esModule',{value:!0});exports.nodesArray=exports.PackG=exports.Text=void 0;var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var _react=require('react'),_react2=_interopRequireDefault(_react),_d=require('d3'),d3=_interopRequireWildcard(_d);function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Text=exports.Text=function(_React$Component){function Text(a){_classCallCheck(this,Text);var _this=_possibleConstructorReturn(this,(Text.__proto__||Object.getPrototypeOf(Text)).call(this,a));return _this.state={fontSize:'12px'},_initialiseProps.call(_this),_this.state={fontSize:'12px'},_this}return _inherits(Text,_React$Component),_createClass(Text,[{key:'componentDidMount',value:function componentDidMount(){// initially set size based on current browser width
// this.setSize();
// update chart size whenever browser resizes
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){appFuncs._.isEqual(a,this.props)||this.setSize()}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(a,b){// only update if state or props have changed
return!appFuncs._.isEqual(b,this.state)||!appFuncs._.isEqual(a,this.props)}/**
   * retrieves container dimensions from client and updates state which triggers redraw
   */},{key:'render',value:function render(){var _this2=this,_props=this.props,a=_props.d,b=_props.labels;return _react2.default.createElement('text',{ref:function ref(c){return _this2.text=c},textAnchor:'middle',className:'label',fontSize:this.state.fontSize,style:{display:'inline',fillOpacity:1}},a.data[b[0]])}}]),Text}(_react2.default.Component);var _initialiseProps=function(){var _this5=this;this.setSize=function(){var a=_this5.props.d.data[_this5.props.labels[0]].length,b=9<a?1:5<a?2.2:2.9,c=25*_this5.props.r*b/window.innerWidth;return 1<Math.abs(parseInt(_this5.state.fontSize)-c)&&_this5.setState({fontSize:c+'vw'}),!0}};var PackG=exports.PackG=function(_React$Component2){function PackG(a){_classCallCheck(this,PackG);var _this3=_possibleConstructorReturn(this,(PackG.__proto__||Object.getPrototypeOf(PackG)).call(this,a));return _this3.state={x:a.d.x,y:a.d.y,r:a.d.r,ox:a.d.x,oy:a.d.y,or:a.d.r,scaleX:1,scaleY:1,scaled:!1,vizConRect:{}},_this3.handleZoom=function(){_this3.state.scaled?_this3.setState({x:_this3.state.ox,y:_this3.state.oy,r:_this3.state.or,scaled:!1}):_this3.setState({x:_this3.state.vizConRect.left+_this3.state.vizConRect.width/2,y:_this3.state.vizConRect.top+_this3.state.vizConRect.height/2,r:Math.min(_this3.state.vizConRect.width,_this3.state.vizConRect.height)/2,scaled:!0})},_this3.state={x:a.d.x,y:a.d.y,r:a.d.r,ox:a.d.x,oy:a.d.y,or:a.d.r,scaleX:1,scaleY:1,scaled:!1,vizConRect:{}},_this3}return _inherits(PackG,_React$Component2),_createClass(PackG,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){(a.d.x!==this.state.ox||a.d.y!==this.state.oy)&&this.setState({x:a.d.x,ox:a.d.x,y:a.d.y,oy:a.d.y,r:a.d.r,or:a.d.r,vizConRect:document.getElementById(this.props.id+'-visual-container').getBoundingClientRect()})}},{key:'render',value:function render(){var _this4=this,_props2=this.props,a=_props2.idx,b=_props2.d,c=_props2.colorScale,f=_props2.labels;return _react2.default.createElement('g',{key:a,transform:'translate('+this.state.x+', '+this.state.y+')',ref:function ref(h){return _this4.g=h},onClick:function onClick(h){h.stopPropagation(),b.children||_this4.handleZoom()}},_react2.default.createElement('circle',{r:this.state.r,className:b.parent?b.children?'node':'node node--leaf':'node node--root',ref:function ref(h){return _this4.circle=h},style:{fill:b.children?c(b.depth):'white',stroke:'#fff',strokeWidth:'1.5px'}}),!b.children&&_react2.default.createElement(Text,{d:b,r:this.state.r,labels:f,idx:a}))}}]),PackG}(_react2.default.Component);var nodesArray=exports.nodesArray=function(_ref){var a=_ref.nodes,b=_ref.colorScale,c=_ref.labels,f=_ref.chartHeight,h=_ref.chartWidth,i=_ref.id,j=[];return a.forEach(function(k,l){return j.push(// TODO: add click handler to each circle for zoom
_react2.default.createElement(PackG,{idx:l,d:k,colorScale:b,labels:c,id:i,chartWidth:h,chartHeight:f}))}),j};